# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ: IDENT ‚Üî AmoCRM

## üìã –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ ‚úÖ

- ‚úÖ –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–æ–¥—É–ª—å
- ‚úÖ Mock AmoCRM –∫–ª–∏–µ–Ω—Ç (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω)
- ‚úÖ –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–µ—Ö 26 –ø–æ–ª–µ–π
- ‚úÖ –õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

## üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth 2.0 –≤ AmoCRM

#### 1.1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ AmoCRM

1. **–í–æ–π–¥–∏—Ç–µ –≤ AmoCRM** –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"**:
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Üí –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
3. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**:
   - –ù–∞–∑–≤–∞–Ω–∏–µ: "IDENT Integration"
   - –û–ø–∏—Å–∞–Ω–∏–µ: "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∏–∑ —Å–∏—Å—Ç–µ–º—ã IDENT"
   - Redirect URI: `http://your-server.com:8080/callback`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è AmoCRM**: [–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](https://www.amocrm.ru/developers/content/oauth/step-by-step)

#### 1.2. –ü–æ–ª—É—á–µ–Ω–∏–µ client_id –∏ client_secret

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
- **Client ID** (–ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á)
- **Client Secret** (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ** - –æ–Ω–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .env —Ñ–∞–π–ª–∞.

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π –≤ AmoCRM

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å **26 –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∏–∑ IDENT.

#### 2.1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–µ–π —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å AmoCRM

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–µ–π**:
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü–æ–ª—è ‚Üí –ö–æ–Ω—Ç–∞–∫—Ç—ã ‚Üí –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ

2. **–°–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è**:

| ‚Ññ | –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è | –¢–∏–ø –ø–æ–ª—è | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---------------|----------|--------------|----------|
| 1 | ID –ø–∞—Ü–∏–µ–Ω—Ç–∞ IDENT | –¢–µ–∫—Å—Ç | –î–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∏–∑ —Å–∏—Å—Ç–µ–º—ã IDENT |
| 2 | –í–æ–∑—Ä–∞—Å—Ç | –ß–∏—Å–ª–æ | –ù–µ—Ç | –í–æ–∑—Ä–∞—Å—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞ |
| 3 | –ü–æ–ª | –°–ø–∏—Å–æ–∫ | –ù–µ—Ç | –ú—É–∂—Å–∫–æ–π/–ñ–µ–Ω—Å–∫–∏–π/–ù–µ —É–∫–∞–∑–∞–Ω |
| 4 | –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è | –î–∞—Ç–∞ | –ù–µ—Ç | –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ |
| 5 | –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞ |
| 6 | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π IDENT | –¢–µ–∫—Å—Ç (–º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π) | –ù–µ—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ IDENT |
| 7 | –ù–æ–º–µ—Ä –ø–∞—Ü–∏–µ–Ω—Ç–∞ | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä –ø–∞—Ü–∏–µ–Ω—Ç–∞ |
| 8 | –°—Ç–∞—Ç—É—Å –ø–∞—Ü–∏–µ–Ω—Ç–∞ | –°–ø–∏—Å–æ–∫ | –ù–µ—Ç | –ê–∫—Ç–∏–≤–Ω—ã–π/–ê—Ä—Ö–∏–≤–Ω—ã–π/–£–¥–∞–ª–µ–Ω |
| 9 | –ü—Ä–∏—á–∏–Ω–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –ü—Ä–∏—á–∏–Ω–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è |
| 10 | –§–∏–ª–∏–∞–ª | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –§–∏–ª–∏–∞–ª –∫–ª–∏–Ω–∏–∫–∏ |
| 11 | –ì–æ—Ä–æ–¥ | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –ì–æ—Ä–æ–¥ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è |
| 12 | –ò–ù–ù | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –ò–ù–ù –ø–∞—Ü–∏–µ–Ω—Ç–∞ |
| 13 | –°–ù–ò–õ–° | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –°–ù–ò–õ–° –ø–∞—Ü–∏–µ–Ω—Ç–∞ |
| 14 | –ü–∞—Å–ø–æ—Ä—Ç | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| 15 | –î–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–∏–∑–∏—Ç–∞ | –î–∞—Ç–∞ | –ù–µ—Ç | –î–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è |
| 16 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤ | –ß–∏—Å–ª–æ | –ù–µ—Ç | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤ |
| 17 | –°—É–º–º–∞ –≤—Å–µ—Ö –≤–∏–∑–∏—Ç–æ–≤ | –ß–∏—Å–ª–æ | –ù–µ—Ç | –û–±—â–∞—è —Å—É–º–º–∞ –ª–µ—á–µ–Ω–∏—è |
| 18 | –°–∫–∏–¥–∫–∞ | –ß–∏—Å–ª–æ | –ù–µ—Ç | –ü—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏ |
| 19 | –ê–≤–∞–Ω—Å | –ß–∏—Å–ª–æ | –ù–µ—Ç | –°—É–º–º–∞ –∞–≤–∞–Ω—Å–∞ |
| 20 | –î–æ–ª–≥ | –ß–∏—Å–ª–æ | –ù–µ—Ç | –°—É–º–º–∞ –¥–æ–ª–≥–∞ |
| 21 | SMS –æ—Ç–∫–∞–∑ | –ß–µ–∫–±–æ–∫—Å | –ù–µ—Ç | –û—Ç–∫–∞–∑ –æ—Ç SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| 22 | –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è | –ù–µ—Ç | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ IDENT |
| 23 | –û—Ç—á–µ—Å—Ç–≤–æ | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –û—Ç—á–µ—Å—Ç–≤–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ |
| 24 | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω | –¢–µ–ª–µ—Ñ–æ–Ω | –ù–µ—Ç | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä |
| 25 | –ê–¥—Ä–µ—Å | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –ê–¥—Ä–µ—Å –ø–∞—Ü–∏–µ–Ω—Ç–∞ |
| 26 | –ò—Å—Ç–æ—á–Ω–∏–∫ | –¢–µ–∫—Å—Ç | –ù–µ—Ç | –ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è |

#### 2.2. –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª–µ–π

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å –∏—Ö ID:

1. **–ß–µ—Ä–µ–∑ API AmoCRM**:
```bash
curl -X GET "https://your-subdomain.amocrm.ru/api/v4/contacts/custom_fields" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

2. **–ò–ª–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–æ–ª–µ–π –Ω–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –ø–æ–ª–µ - ID –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –≤ URL

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è](https://www.amocrm.ru/developers/content/crm_platform/custom-fields)

### 3. –ü–µ—Ä–≤–∏—á–Ω–∞—è OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

#### 3.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env_example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cp .env_example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:
```env
# AmoCRM Configuration
AMOCRM_SUBDOMAIN=your_subdomain
AMOCRM_CLIENT_ID=your_client_id_here
AMOCRM_CLIENT_SECRET=your_client_secret_here
AMOCRM_REDIRECT_URI=http://your-server.com:8080/callback

# Database Configuration
DB_HOST=your_ident_db_host
DB_PORT=1433
DB_NAME=PZ
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_DRIVER={ODBC Driver 18 for SQL Server}

# Other settings
USE_MOCK_AMOCRM=false
LOG_LEVEL=INFO
```

#### 3.2. –ü–æ–ª—É—á–µ–Ω–∏–µ authorization code

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ OAuth —Å–µ—Ä–≤–µ—Ä**:
```bash
docker compose --profile auth up auth
```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ URL –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**:
```
https://your-subdomain.amocrm.ru/oauth?mode=request&client_id=YOUR_CLIENT_ID&redirect_uri=http://your-server.com:8080/callback&response_type=code
```

3. **–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–æ—Å—Ç—É–ø** –≤ AmoCRM

4. **–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥** - –æ–Ω –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω –Ω–∞ –≤–∞—à redirect_uri

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](https://www.amocrm.ru/developers/content/oauth/step-by-step)

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ –ø–æ–ª–µ–π

#### 4.1. –û–±–Ω–æ–≤–∏—Ç–µ src/models.py

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è ID –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π –æ–±–Ω–æ–≤–∏—Ç–µ –º–∞–ø–ø–∏–Ω–≥ –≤ `src/models.py`:

```python
def to_amocrm_format(self) -> Dict[str, Any]:
    """Convert patient to AmoCRM format."""
    custom_fields = [
        {'field_id': 123, 'values': [{'value': str(self.id_patient)}]},  # ID –ø–∞—Ü–∏–µ–Ω—Ç–∞ IDENT
        {'field_id': 124, 'values': [{'value': self.person.age or 0}]},  # –í–æ–∑—Ä–∞—Å—Ç
        # ... –¥–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ ID
    ]
```

#### 4.2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É [amocrm_api](https://github.com/Krukov/amocrm_api) –æ—Ç Krukov:

```bash
pip install amocrm_api
```

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```python
from amocrm.v2 import tokens, Contact

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤
tokens.default_token_manager(
    client_id="your-client-id",
    client_secret="your-client-secret",
    subdomain="your-subdomain",
    redirect_url="http://your-server.com:8080/callback",
    storage=tokens.FileTokensStorage(),
)

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
contact = Contact(
    first_name="–ò–≤–∞–Ω",
    last_name="–ò–≤–∞–Ω–æ–≤",
    phone="+7 925 123-45-67"
)
contact.create()
```

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**: [amocrm_api –Ω–∞ GitHub](https://github.com/Krukov/amocrm_api)

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö IDENT

#### 5.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ODBC –¥—Ä–∞–π–≤–µ—Ä–æ–≤

**–ù–∞ Ubuntu/Debian**:
```bash
curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -
curl https://packages.microsoft.com/config/ubuntu/20.04/prod.list > /etc/apt/sources.list.d/mssql-release.list
apt-get update
ACCEPT_EULA=Y apt-get install -y msodbcsql18
```

**–ù–∞ CentOS/RHEL**:
```bash
curl https://packages.microsoft.com/config/rhel/8/prod.repo > /etc/yum.repos.d/mssql-release.repo
yum remove unixODBC-utf16 unixODBC-utf16-devel
ACCEPT_EULA=Y yum install -y msodbcsql18
```

#### 5.2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ IDENT –ë–î
docker compose exec sync python main.py test-db
```

### 6. –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

#### 6.1. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker compose build

# –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
docker compose up -d sync

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose logs -f sync
```

#### 6.2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞

```bash
# –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞
docker compose exec sync python main.py test --patient-id 1
```

#### 6.3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs sync

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
docker compose restart sync
```

### 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞:
- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
- **–ì–ª—É–±–æ–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –¥–≤–∞–∂–¥—ã –≤ –¥–µ–Ω—å (8:00 –∏ 20:00)

–ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–æ–∂–Ω–æ –≤ `.env`:
```env
SYNC_INTERVAL_MINUTES=5  # –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª
DEEP_SYNC_HOUR_MORNING=9  # –ò–∑–º–µ–Ω–∏—Ç—å —É—Ç—Ä–µ–Ω–Ω–µ–µ –≤—Ä–µ–º—è
DEEP_SYNC_HOUR_EVENING=21  # –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è AmoCRM:
- [–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤](https://www.amocrm.ru/developers/)
- [OAuth 2.0 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](https://www.amocrm.ru/developers/content/oauth/step-by-step)
- [API –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤](https://www.amocrm.ru/developers/content/crm_platform/contacts-api)
- [–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è](https://www.amocrm.ru/developers/content/crm_platform/custom-fields)
- [–õ–∏–º–∏—Ç—ã API](https://www.amocrm.ru/developers/content/crm_platform/rate-limits)

### –ì–æ—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
- [amocrm_api (Krukov)](https://github.com/Krukov/amocrm_api) - –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- [PyPI: amocrm-api](https://pypi.org/project/amocrm-api/) - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ pip

### Microsoft SQL Server:
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ ODBC –¥—Ä–∞–π–≤–µ—Ä–æ–≤](https://docs.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server)

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid grant" –ø—Ä–∏ OAuth
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å redirect_uri –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

### –ü—Ä–æ–±–ª–µ–º–∞: "Field not found" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è —Å–æ–∑–¥–∞–Ω—ã –∏ ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î IDENT
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ODBC –¥—Ä–∞–π–≤–µ—Ä—ã –∏ connection string

### –ü—Ä–æ–±–ª–µ–º–∞: Rate limit exceeded
**–†–µ—à–µ–Ω–∏–µ**: AmoCRM –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç 7 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É. –£–≤–µ–ª–∏—á—å—Ç–µ BATCH_SIZE –≤ .env

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ AmoCRM
- [ ] –ü–æ–ª—É—á–µ–Ω—ã client_id –∏ client_secret
- [ ] –°–æ–∑–¥–∞–Ω—ã 26 –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π
- [ ] –ü–æ–ª—É—á–µ–Ω—ã ID –≤—Å–µ—Ö –ø–æ–ª–µ–π
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –≤ src/models.py
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω .env —Ñ–∞–π–ª
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω–∞ OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã ODBC –¥—Ä–∞–π–≤–µ—Ä—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ IDENT –ë–î
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- [ ] –ó–∞–ø—É—â–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ. –í—Å–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã –∏–∑ IDENT –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å AmoCRM —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

**–í—Ä–µ–º—è –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫—É**: 2-4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è  
**–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ 