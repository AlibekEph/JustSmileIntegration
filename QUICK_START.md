# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç IDENT ‚Üî AmoCRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ ‚úÖ

1. **–ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–æ–¥—É–ª—å** –º–µ–∂–¥—É IDENT –∏ AmoCRM
2. **Mock AmoCRM –∫–ª–∏–µ–Ω—Ç** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π
3. **–¢–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** SQL Server —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
5. **–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è üìä

```
‚úÖ Mock AmoCRM Tests: 100% —É—Å–ø–µ—à–Ω–æ
‚úÖ Patient Model Tests: 100% —É—Å–ø–µ—à–Ω–æ  
‚úÖ Database Tests: 100% —É—Å–ø–µ—à–Ω–æ
‚úÖ Integration Tests: 100% —É—Å–ø–µ—à–Ω–æ
```

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### 1. –¢–µ—Å—Ç Mock AmoCRM (–±–µ–∑ –ë–î)
```bash
python3 test_mock_integration.py
```

### 2. –¢–µ—Å—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
docker compose -f docker-compose.test.yml up -d sqlserver redis

# –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 —Å–µ–∫—É–Ω–¥ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
sleep 10
docker exec -i ident_test_db /opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P 'TestPassword123!' -C < test_data/init_test_db.sql

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å pyodbc/pymssql)
python3 test_db_integration.py

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.test.yml down
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
```bash
docker exec ident_test_db /opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P 'TestPassword123!' -C -Q "SELECT COUNT(*) FROM PZ.dbo.Patients"
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ üìÅ

```
JustSmile/
‚îú‚îÄ‚îÄ src/                    # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ models.py          # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ database.py        # –†–∞–±–æ—Ç–∞ —Å IDENT –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ amocrm.py          # –†–µ–∞–ª—å–Ω—ã–π AmoCRM –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ test_amocrm.py     # Mock AmoCRM –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ sync.py            # –õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ requirements.txt       # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile             # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml     # –ü—Ä–æ–¥–∞–∫—à–µ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.test.yml # –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ test_data/             # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îî‚îÄ‚îÄ logs/                  # –õ–æ–≥–∏
```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ üîß

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª
cp .env_example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
docker compose up -d sync

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å OAuth —Å–µ—Ä–≤–µ—Ä (–¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
docker compose --profile auth up auth

# 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞
docker compose exec sync python main.py test --patient-id 1

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs -f sync
```

## –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ üéØ

1. **AmoCRM –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**:
   - –ü–æ–ª—É—á–∏—Ç—å client_id –∏ client_secret
   - –°–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è –¥–ª—è 26 –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø–∞—Ü–∏–µ–Ω—Ç–∞
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö IDENT**:
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å connection string –∫ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ODBC –¥—Ä–∞–π–≤–µ—Ä—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

3. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**:
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å docker compose

## –§–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è üìñ

- `TESTING_REPORT.md` - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- `README.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `test_mock_integration.py` - –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å mock API
- `src/models.py` - –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π IDENT ‚Üí AmoCRM

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ üí¨

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î IDENT. 